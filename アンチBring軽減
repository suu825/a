local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui") -- CoreGuiに配置

-- トグルの状態を管理する変数
local toggleEnabled = false

local function processPart(part)
    local character = Players.LocalPlayer.Character
    if not toggleEnabled or not character or not character:FindFirstChild("Head") or not part:IsA("BasePart") then
        return
    end

    if part.Anchored or part:IsDescendantOf(character) then
        return
    end

    if part.Name == "Torso" or part.Name == "Head" or part.Name == "Right Arm" or part.Name == "Left Arm" or
       part.Name == "Right Leg" or part.Name == "Left Leg" or part.Name == "HumanoidRootPart" then
        return
    end

    -- `BodyPosition` が既に存在するか確認
    local existingForce = part:FindFirstChildOfClass("BodyPosition")
    if existingForce then
        existingForce.Position = Vector3.new(0, 20000000, 0)
        return
    end

    -- 新しい `BodyPosition` を作成
    local ForceInstance = Instance.new("BodyPosition")
    ForceInstance.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    ForceInstance.Position = Vector3.new(0, 20000000, 0)
    ForceInstance.P = 6000000000000 -- 強さ (値を大きくするほど速く目標座標に移動)
    ForceInstance.D = 6000000 -- 減衰 (値を大きくするほど振動を抑制)
    ForceInstance.Parent = part
end

-- 初期ロード時にすべてのパーツを処理
local function processAllParts()
    for _, part in pairs(Workspace:GetDescendants()) do
        processPart(part)
    end
end

-- ブロブマン関連の部位や名前を削除
local function deleteBlobmanParts()
    for _, descendant in pairs(Workspace:GetDescendants()) do
        if descendant.Name == "ブロブマン" then
            descendant:Destroy()
        end
        if descendant.Name == "LeftDetector" or descendant.Name == "RightDetector" then
            descendant:Destroy()
        end
        if descendant.Name == "BlobmanSeatAndOwnerScript" then
            descendant:Destroy()
        end
    end
end

-- GUI の作成
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local MainScreenGui = Instance.new("ScreenGui")
MainScreenGui.Name = "MainGui"
MainScreenGui.ResetOnSpawn = false -- リスポーン後も GUI を保持
MainScreenGui.Parent = playerGui

-- メインフレーム作成
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 350, 0, 300) -- 幅350、高さ300
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -150) -- 中央に配置
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50) -- ダークグレー
MainFrame.Parent = MainScreenGui

-- ブロブマン破壊ボタン
local blobmanButton = Instance.new("TextButton")
blobmanButton.Name = "DeleteBlobmanButton"
blobmanButton.Size = UDim2.new(0, 150, 0, 50) -- 幅150, 高さ50
blobmanButton.Position = UDim2.new(0, 10, 0, 10) -- 左上端から余白を持たせて配置
blobmanButton.Text = "ブロブマン破壊"
blobmanButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- 赤色
blobmanButton.Font = Enum.Font.SourceSansBold
blobmanButton.TextSize = 14
blobmanButton.Parent = MainFrame

-- Bring軽減ボタン（ブロブマン破壊ボタンの右隣に配置）
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0, 150, 0, 50)
toggleButton.Position = UDim2.new(0, 170, 0, 10) -- 無敵ボタンの右隣に配置
toggleButton.Text = "Bring軽減　オンにする"
toggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 18
toggleButton.Parent = MainFrame

-- トグルボタンのクリック時の動作
toggleButton.MouseButton1Click:Connect(function()
    toggleEnabled = not toggleEnabled

    if toggleEnabled then
        toggleButton.Text = "Bring軽減　オン"
        toggleButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        processAllParts()
    else
        toggleButton.Text = "Bring軽減　オフ"
        toggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    end
end)

-- ドラッグ機能の修正
local dragging = false
local dragStart, startPos

-- MainFrameをドラッグ可能にする（PC用とスマホ用）
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

MainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- 新たに追加されたパーツをリアルタイムで処理
Workspace.DescendantAdded:Connect(function(part)
    if toggleEnabled then
        processPart(part)
    end
end)

-- ブロブマン破壊ボタンの動作設定
blobmanButton.MouseButton1Click:Connect(function()
    deleteBlobmanParts()
end)
