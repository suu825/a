local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

-- トグルの状態を管理する変数
local toggleEnabled = false

local function processPart(part)
    local character = Players.LocalPlayer.Character
    if not toggleEnabled or not character or not character:FindFirstChild("Head") or not part:IsA("BasePart") then
        return
    end

    if part.Anchored or part:IsDescendantOf(character) then
        return
    end

    if part.Name == "Torso" or part.Name == "Head" or part.Name == "Right Arm" or part.Name == "Left Arm" or
       part.Name == "Right Leg" or part.Name == "Left Leg" or part.Name == "HumanoidRootPart" then
        return
    end

    local existingForce = part:FindFirstChildOfClass("BodyPosition")
    if existingForce then
        existingForce.Position = Vector3.new(0, 20000000, 0)
        return
    end

    local ForceInstance = Instance.new("BodyPosition")
    ForceInstance.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    ForceInstance.Position = Vector3.new(0, 20000000, 0)
    ForceInstance.P = 6000000000000
    ForceInstance.D = 6000000
    ForceInstance.Parent = part
end

-- 初期ロード時にすべてのパーツを処理
local function processAllParts()
    for _, part in pairs(Workspace:GetDescendants()) do
        processPart(part)
    end
end

-- ブロブマン関連の部位や名前を削除
local function deleteBlobmanParts()
    for _, descendant in pairs(Workspace:GetDescendants()) do
        if descendant.Name == "ブロブマン" or descendant.Name == "LeftDetector" or descendant.Name == "RightDetector" or descendant.Name == "BlobmanSeatAndOwnerScript" then
            descendant:Destroy()
        end
    end
end

-- 他のプレイヤーの名前に基づいて "名前SpawnedInToys" を削除
local function deleteSpawnedInToys()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            local toyName = player.Name .. "SpawnedInToys"
            local toys = Workspace:FindFirstChild(toyName)
            if toys then
                toys:Destroy()
                print(toyName .. " を削除しました")
            end
        end
    end
end

-- GUI の作成
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local MainScreenGui = Instance.new("ScreenGui")
MainScreenGui.Name = "MainGui"
MainScreenGui.ResetOnSpawn = false
MainScreenGui.Parent = playerGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 350, 0, 300)
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.Parent = MainScreenGui

-- ブロブマン破壊ボタン
local blobmanButton = Instance.new("TextButton")
blobmanButton.Name = "DeleteBlobmanButton"
blobmanButton.Size = UDim2.new(0, 150, 0, 50)
blobmanButton.Position = UDim2.new(0, 10, 0, 10)
blobmanButton.Text = "ブロブマン破壊"
blobmanButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
blobmanButton.Font = Enum.Font.SourceSansBold
blobmanButton.TextSize = 14
blobmanButton.Parent = MainFrame

-- SpawnedInToys削除ボタン
local toysButton = Instance.new("TextButton")
toysButton.Name = "DeleteSpawnedInToysButton"
toysButton.Size = UDim2.new(0, 150, 0, 50)
toysButton.Position = UDim2.new(0, 170, 0, 10)
toysButton.Text = "ブロブマン破壊V2"
toysButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toysButton.Font = Enum.Font.SourceSansBold
toysButton.TextSize = 14
toysButton.Parent = MainFrame

-- Bring軽減ボタン
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0, 150, 0, 50)
toggleButton.Position = UDim2.new(0, 10, 0, 70)
toggleButton.Text = "Bring軽減 オンにする"
toggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 18
toggleButton.Parent = MainFrame

-- トグルボタンの動作
toggleButton.MouseButton1Click:Connect(function()
    toggleEnabled = not toggleEnabled
    if toggleEnabled then
        toggleButton.Text = "Bring軽減 オン"
        toggleButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        processAllParts()
    else
        toggleButton.Text = "Bring軽減 オフ"
        toggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    end
end)

-- MainFrameのドラッグ機能
local dragging = false
local dragStart, startPos

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

MainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- 各ボタンの動作設定
blobmanButton.MouseButton1Click:Connect(function()
    deleteBlobmanParts()
end)

toysButton.MouseButton1Click:Connect(function()
    deleteSpawnedInToys()
end)

Workspace.DescendantAdded:Connect(function(part)
    if toggleEnabled then
        processPart(part)
    end
end)
